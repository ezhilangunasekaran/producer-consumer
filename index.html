<!DOCTYPE html>
<html>
<!--
Author: Ezhilan Gunsekaran
Producer Consumer Problem in JS
A program to represent the producer and consumer problem.  
 -->

<head>
    <script src="jquery-2.1.4.min.js"></script>
    <style>
        li {
            float: left;
            width: 69px;
            background: transparent url(https://cloud.githubusercontent.com/assets/4058750/10989203/fd189b02-8409-11e5-93e2-9dcd442014a2.png) repeat scroll 0 0 / 70px auto;
            height: 42px;
        }
    </style>
</head>
<!-- The visual part of the program -->

<body>
    <h3>Producer Consumer Problem in JS</h3>
    <!-- Inputs fields for producer and consumer -->
    <form>
        Number of items deposited by the producer:
        <input id="producer" type="number">
        <br> Number of items consumed by the consumer:
        <input id="consumer" type="number">
        <br>
        <a style="background:#ddd; padding: 4px 10px; cursor: pointer;" id="submit">submit</a>
    </form>

    <br>
    <!-- A visual representation using pizza-->
    <div style="width: 100%; height: 100px; text-align: center;">
        <span style="float: left; background: transparent url(https://cloud.githubusercontent.com/assets/4058750/10989226/37e21c40-840a-11e5-8564-7fea8115de90.jpg) repeat scroll 0% 0%; height: 160px; width: 128px;margin-right: 30px;"></span>
        <span style="background: transparentS url(https://cloud.githubusercontent.com/assets/4058750/10989223/2630b100-840a-11e5-8a3a-a2e6d9590bb0.png) repeat scroll 0 0 / 70px auto;float: left;height: 130px;width: 560px;margin-top:30px;">

<ul id="gui" style="padding: 0px; list-style: outside none none; margin: 0px; width: 560px; height: 130px;">
</ul>

</span>
        <span style="float: left; background: transparent url(https://cloud.githubusercontent.com/assets/4058750/10989187/b0ca4d04-8409-11e5-825a-1d9bd7d02bad.jpg) repeat scroll 0% 0%; height: 160px; width: 128px;margin-left: 30px;margin-top:10px;"></span>
    </div>
    <!-- A live Activity log -->
    <h3 style="float: left; text-align: center; width: 100%;">Activity Log</h3>
    <div id="activity" style="width: 700px; height:280px; overflow: scroll; text-align: center; margin: 0px auto;background:#eee;"></div>
</body>

</html>

<script type="text/javascript">
    //Variable Declaration
    var B = []; // Buffer declaration
    var buff_limit = 24; // buffer limit is 24
    var S = buff_limit; // declaring space available with initial value set as buffer limit
    var I = 0; // declaring and initializing items available as 0
    // click event for submit button.
    // getting values from inpur field
    $("#submit").click(function() {
        window.P = parseInt($("#producer").val()); // getting producer value
        window.C = parseInt($("#consumer").val()); // getting consumer value
        onclk();
    });
    var itr = "item";
    //Once started
    // function for Producer
    function producer() {
        if (S >= window.P) { // checking Space available is greater than or equal to producer 
            for (i = 0; i < window.P; i++) {
                B.push(itr); // pushing items in to space in buffer.
                $("#gui").append("<li></li>");
            }
            // Notification for 
            console.log("Producer pushed" + window.P + "items");
            $("#activity").append("<b style=color:green>Producer pushed " + window.P + " items</b><br>");
            console.log(B);
            I = B.length; // signaling no of items available
            console.log(I);
        } else { // condition for in availablity of space
            console.log("no space available");
            $("#activity").append("<b style=color:red>No space available<b><br>");
        }
    }

    //consumer function to consume items
    function consumer() {
        setTimeout(function() { // to maintain a 1sec gap between producer and consumer
            if (I >= window.C) { // checking for available items
                for (i = 0; i < window.C; i++) {
                    B.splice(0, 1); // consuming items fron the buffer
                    $("li").first().remove();
                }
                console.log("Consumer removed " + window.C + " items");
                $("#activity").append("<b style=color:orange>Consumer removed " + window.C + " items</b><br>");
                console.log(B);
                S = buff_limit - B.length; // signaling no of space available
                console.log(S);
            } else {
                console.log("no items available");
                $("#activity").append("<b style=color:red>No items available<b><br>");
            }
        }, 1000);
    }
    //click function intiated when submit button is triggered.
    function onclk() {
        var set_prod_func = setInterval(producer, 2000); // initiating the producer function on click
        var set_con_func = setInterval(consumer, 2000); // initiating the consumer function on click
        console.log("started");
    }
</script>
